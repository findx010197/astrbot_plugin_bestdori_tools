# AstrBot Bestdori å·¥å…·æ’ä»¶

<p align="center">
  <img src="logo.jpg" width="120" alt="Logo">
</p>

BanG Dream! å°‘å¥³ä¹å›¢æ´¾å¯¹ æ¸¸æˆä¿¡æ¯æŸ¥è¯¢å·¥å…·æ’ä»¶ï¼ŒåŸºäº [Bestdori](https://bestdori.com) API æä¾›ä¸°å¯Œçš„æ¸¸æˆæ•°æ®æŸ¥è¯¢åŠŸèƒ½ã€‚

**ç‰ˆæœ¬**: v1.2.0 | **ä½œè€…**: findx1197

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ“… æ´»åŠ¨æŸ¥è¯¢
- æŸ¥è¯¢å½“æœŸæ´»åŠ¨ä¿¡æ¯ï¼ˆå›½æœ/æ—¥æœ/å›½é™…æœç­‰ï¼‰
- æ´»åŠ¨ç»¼åˆä¸€è§ˆï¼ˆæ–°å¡é¢ã€æ‹›å‹Ÿå¡æ± ã€æŠ¥é…¬æˆå‘˜ã€è¿½åŠ æ­Œæ›²ï¼‰
- æ”¯æŒæŒ‡å®šæ´»åŠ¨IDæŸ¥è¯¢å†å²æ´»åŠ¨
- ç²¾ç¾çš„æ´»åŠ¨ä¿¡æ¯é•¿å›¾æ¸²æŸ“

### ğŸ´ å¡é¢æŸ¥è¯¢
- æŒ‰è§’è‰²æŸ¥è¯¢æ‰€æœ‰å¡é¢ï¼ˆæŒ‰å±æ€§åˆ†ç±»ï¼‰
- æœ€æ–°æ´»åŠ¨å¡é¢ä¸€è§ˆ
- å¡é¢è¯¦æƒ…å±•ç¤ºï¼ˆç‰¹è®­å‰åå¯¹æ¯”ï¼‰
- æ”¯æŒè§’è‰²åˆ«åæœç´¢ï¼ˆå¦‚ ksm=é¦™æ¾„, ykn=å‹å¸Œé‚£ï¼‰

### ğŸ‚ ç”Ÿæ—¥ç³»ç»Ÿ
- è§’è‰²ç”Ÿæ—¥æŸ¥è¯¢ä¸ç¥ç¦å¡ç‰‡
- **å®šæ—¶ç”Ÿæ—¥æ’­æŠ¥**ï¼ˆå¯é…ç½®æ¨é€æ—¶é—´å’Œç›®æ ‡ç¾¤ç»„ï¼‰
- ç”Ÿæ—¥é™å®šå¡é¢å±•ç¤º
- æ”¯æŒ46ä¸ªè§’è‰²çš„å®Œæ•´ç”Ÿæ—¥æ•°æ®

### ğŸ“¢ è®¢é˜…ä¸æ’­æŠ¥
- ç”¨æˆ·è®¢é˜…ç®¡ç†ï¼ˆè‡ªåŠ¨/æ‰‹åŠ¨è®¢é˜…ï¼‰
- ç¾¤ç»„æ’­æŠ¥é…ç½®
- æ’­æŠ¥å†…å®¹ï¼šç”Ÿæ—¥ç¥ç¦ã€æ´»åŠ¨æé†’ï¼ˆå¯æ‰©å±•ï¼‰
- çµæ´»çš„æ’­æŠ¥æ—¶é—´å’Œç›®æ ‡è®¾ç½®

### ğŸ”§ ç®¡ç†åŠŸèƒ½
- ç¼“å­˜ç®¡ç†ï¼ˆç»Ÿè®¡ã€æ¸…ç†ã€æ¸…ç©ºï¼‰
- APIæ•°æ®åˆ·æ–°
- è®¢é˜…è€…ç®¡ç†
- ç›®å½•é…ç½®

## ğŸ“¦ å®‰è£…æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šé€šè¿‡ AstrBot WebUI å®‰è£…ï¼ˆæ¨èï¼‰

1. è¿›å…¥ AstrBot ç®¡ç†åå°
2. å¯¼èˆªåˆ°ã€Œæ’ä»¶ç®¡ç†ã€â†’ã€Œæ·»åŠ æœ¬åœ°æ’ä»¶ã€
3. é€‰æ‹© `astrbot_plugin_bestdori_tools` æ–‡ä»¶å¤¹
4. æ’ä»¶å°†**è‡ªåŠ¨æ£€æŸ¥å¹¶å®‰è£…**æ‰€éœ€ä¾èµ–

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å®‰è£…

1. å°†æ’ä»¶æ–‡ä»¶å¤¹å¤åˆ¶åˆ° AstrBot æ’ä»¶ç›®å½•ï¼š
   ```
   AstrBot/addons/plugins/astrbot_plugin_bestdori_tools/
   ```

2. å®‰è£…ä¾èµ–ï¼š
   ```bash
   cd AstrBot
   .venv\Scripts\activate  # Windows
   # æˆ– source .venv/bin/activate  # Linux/Mac
   pip install -r addons/plugins/astrbot_plugin_bestdori_tools/requirements.txt
   ```

3. é‡å¯ AstrBot

### ç³»ç»Ÿè¦æ±‚

- **Python**: 3.9+
- **æµè§ˆå™¨**: Chrome æˆ– Chromiumï¼ˆç”¨äº HTML æ¸²æŸ“ï¼‰
- **ç½‘ç»œ**: éœ€è¦è®¿é—® bestdori.com

> ğŸ’¡ æ’ä»¶å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ£€æŸ¥ä¾èµ–å’Œæµè§ˆå™¨ç¯å¢ƒï¼Œç¼ºå¤±æ—¶ä¼šå°è¯•è‡ªåŠ¨å®‰è£…

### Docker ç¯å¢ƒæ³¨æ„äº‹é¡¹

å¦‚æœä½ ä½¿ç”¨ Docker éƒ¨ç½² AstrBotï¼Œéœ€è¦ç¡®ä¿å®¹å™¨ä¸­å®‰è£…äº† Chromium æµè§ˆå™¨å’Œä¸­æ–‡å­—ä½“ï¼š

```dockerfile
# åœ¨ Dockerfile ä¸­æ·»åŠ 
RUN apt-get update && apt-get install -y \
    chromium \
    chromium-driver \
    fonts-noto-cjk \
    fonts-wqy-microhei \
    && rm -rf /var/lib/apt/lists/*
```

æˆ–è€…åœ¨è¿è¡Œå®¹å™¨åæ‰‹åŠ¨å®‰è£…ï¼š
```bash
# å®‰è£… Chromium æµè§ˆå™¨
docker exec -it <container_name> apt-get update
docker exec -it <container_name> apt-get install -y chromium

# å®‰è£…ä¸­æ–‡å­—ä½“ï¼ˆè§£å†³æ¸²æŸ“ä¹±ç é—®é¢˜ï¼‰
docker exec -it <container_name> apt-get install -y fonts-noto-cjk fonts-wqy-microhei

# åˆ·æ–°å­—ä½“ç¼“å­˜
docker exec -it <container_name> fc-cache -fv
```

> âš ï¸ **é‡è¦**: å¦‚æœä¸å®‰è£…ä¸­æ–‡å­—ä½“ï¼Œç”Ÿæˆçš„å¡ç‰‡å›¾ç‰‡ä¸­çš„ä¸­æ–‡ä¼šæ˜¾ç¤ºä¸ºæ–¹å—ä¹±ç 

### æ¸…ç†æ®‹ç•™æ–‡ä»¶

å¦‚æœåœ¨æ—¥å¿—ä¸­çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹è­¦å‘Šï¼Œè¿™æ˜¯å› ä¸º plugins ç›®å½•ä¸­å­˜åœ¨æ— æ•ˆçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼š

```
æ’ä»¶ astrbot_plugin_bestdori_tools-xxxxx æœªæ‰¾åˆ° main.pyï¼Œè·³è¿‡ã€‚
æ’ä»¶ astrbot_plugin_bestdori_tools.rar æœªæ‰¾åˆ° main.pyï¼Œè·³è¿‡ã€‚
```

è¿™äº›è­¦å‘Š**ä¸å½±å“æ’ä»¶è¿è¡Œ**ï¼Œä½†å¦‚æœæƒ³æ¸…ç†å®ƒä»¬ï¼Œå¯ä»¥æ‰§è¡Œï¼š

```bash
# è¿›å…¥ Docker å®¹å™¨
docker exec -it <container_name> bash

# åˆ é™¤æ®‹ç•™æ–‡ä»¶ï¼ˆè¯·æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´è·¯å¾„ï¼‰
cd /AstrBot/data/plugins
rm -rf astrbot_plugin_bestdori_tools-*
rm -f astrbot_plugin_bestdori_tools.rar
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºç¡€å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `/bd` | æ˜¾ç¤ºä¸»èœå• |
| `/bd help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |
| `/bd event` | æŸ¥è¯¢å½“æœŸæ´»åŠ¨ï¼ˆé»˜è®¤å›½æœï¼‰ |
| `/bd event jp` | æŸ¥è¯¢æ—¥æœå½“æœŸæ´»åŠ¨ |
| `/bd event 297` | æŸ¥è¯¢æŒ‡å®šIDçš„æ´»åŠ¨ |

### å¡é¢æŸ¥è¯¢

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `/bd é¦™æ¾„` | æŸ¥è¯¢é¦™æ¾„çš„æ‰€æœ‰å¡é¢ |
| `/bd ksm` | ä½¿ç”¨åˆ«åæŸ¥è¯¢é¦™æ¾„å¡é¢ |
| `/bd æœ€æ–°å¡é¢` | æŸ¥çœ‹æœ€è¿‘æ´»åŠ¨çš„æ–°å¡é¢ |
| `/bd id 1234` | æŸ¥çœ‹æŒ‡å®šIDçš„å¡é¢å¤§å›¾ |

### ç”Ÿæ—¥æŸ¥è¯¢

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `/bd ç”Ÿæ—¥` | æŸ¥çœ‹ä»Šå¤©è¿‡ç”Ÿæ—¥çš„è§’è‰² |
| `/bd ç”Ÿæ—¥ é¦™æ¾„` | æŸ¥çœ‹é¦™æ¾„çš„ç”Ÿæ—¥ä¿¡æ¯ |
| `/bd birthday ykn` | ä½¿ç”¨åˆ«åæŸ¥è¯¢å‹å¸Œé‚£ç”Ÿæ—¥ |

### ç®¡ç†å‘½ä»¤ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `/bd admin` | è¿›å…¥ç®¡ç†èœå• |
| `/bd admin cache` | ç¼“å­˜ç®¡ç† |
| `/bd admin subscribers` | æŸ¥çœ‹è®¢é˜…åˆ—è¡¨ |
| `/bd subscribe` | è®¢é˜…æ’­æŠ¥ |
| `/bd unsubscribe` | å–æ¶ˆè®¢é˜… |

### å¿«æ·æ•°å­—é€‰æ‹©

è¿›å…¥èœå•åå¯ä½¿ç”¨æ•°å­—å¿«æ·é€‰æ‹©ï¼š
- `/1` `/2` `/3` ç­‰ - é€‰æ‹©å¯¹åº”èœå•é¡¹
- `/0` - è¿”å›ä¸Šçº§èœå•

## âš™ï¸ é…ç½®è¯´æ˜

åœ¨ AstrBot åå°çš„æ’ä»¶é…ç½®é¡µé¢å¯ä»¥è®¾ç½®ï¼š

### åŸºç¡€é…ç½®
| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `admin_users` | ç®¡ç†å‘˜QQå·åˆ—è¡¨ | `[]` |
| `default_server` | é»˜è®¤æŸ¥è¯¢æœåŠ¡å™¨ | `cn` |
| `server_fallback` | å¯ç”¨æœåŠ¡å™¨å›é€€ | `true` |

### æ’­æŠ¥é…ç½®
| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `broadcast_enabled` | å¯ç”¨å®šæ—¶æ’­æŠ¥ | `false` |
| `broadcast_to_groups` | æ¨é€åˆ°ç¾¤ç»„ | `false` |
| `broadcast_groups` | æ¥æ”¶ç¾¤ç»„åˆ—è¡¨ | `[]` |
| `broadcast_to_users` | æ¨é€ç»™è®¢é˜…ç”¨æˆ· | `false` |

### ç”Ÿæ—¥æ’­æŠ¥é…ç½®
| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `birthday_broadcast.enabled` | å¯ç”¨ç”Ÿæ—¥ç¥ç¦ | `true` |
| `birthday_broadcast.broadcast_hour` | æ’­æŠ¥å°æ—¶ | `0` |
| `birthday_broadcast.broadcast_minute` | æ’­æŠ¥åˆ†é’Ÿ | `0` |

### ç¼“å­˜é…ç½®
| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `cache_enabled` | å¯ç”¨æ¸²æŸ“ç¼“å­˜ | `true` |
| `cache_max_size` | æœ€å¤§ç¼“å­˜å¤§å°(MB) | `500` |
| `cache_event_ttl` | æ´»åŠ¨ç¼“å­˜æœ‰æ•ˆæœŸ(ç§’) | `3600` |

## ğŸ“ æ–‡ä»¶ç»“æ„

```
astrbot_plugin_bestdori_tools/
â”œâ”€â”€ main.py                  # æ’ä»¶ä¸»å…¥å£
â”œâ”€â”€ client.py                # Bestdori API å®¢æˆ·ç«¯
â”œâ”€â”€ models.py                # æ•°æ®æ¨¡å‹ (Event, Card, Gacha)
â”œâ”€â”€ consts.py                # å¸¸é‡å®šä¹‰ (è§’è‰²/ä¹é˜Ÿæ˜ å°„ç­‰)
â”œâ”€â”€ menu_context.py          # èœå•ä¸Šä¸‹æ–‡ç®¡ç†
â”œâ”€â”€ birthday_service.py      # ç”Ÿæ—¥æœåŠ¡æ¨¡å—
â”œâ”€â”€ subscriber_service.py    # è®¢é˜…ç®¡ç†æœåŠ¡
â”œâ”€â”€ scheduler.py             # å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
â”œâ”€â”€ cache_manager.py         # ç¼“å­˜ç®¡ç†å™¨
â”œâ”€â”€ render_service.py        # HTML æ¸²æŸ“æœåŠ¡
â”œâ”€â”€ resource_manager.py      # èµ„æºç®¡ç†å™¨
â”œâ”€â”€ dependency_manager.py    # ä¾èµ–è‡ªåŠ¨å®‰è£…
â”œâ”€â”€ image_utils.py           # å›¾ç‰‡å¤„ç†å·¥å…·
â”œâ”€â”€ templates/               # HTML æ¨¡æ¿
â”‚   â”œâ”€â”€ event_card.html
â”‚   â”œâ”€â”€ event_overview_card.html
â”‚   â”œâ”€â”€ birthday_card.html
â”‚   â”œâ”€â”€ card_list.html
â”‚   â””â”€â”€ latest_cards.html
â”œâ”€â”€ data/                    # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ assets/              # é™æ€èµ„æº
â”‚   â”œâ”€â”€ bestdori_cache/      # API æ•°æ®ç¼“å­˜
â”‚   â””â”€â”€ bestdori_tools/      # è¿è¡Œæ—¶æ•°æ®
â”œâ”€â”€ metadata.yaml            # æ’ä»¶å…ƒæ•°æ®
â”œâ”€â”€ requirements.txt         # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ _conf_schema.json        # é…ç½®æ¨¡å¼å®šä¹‰
â””â”€â”€ README.md                # è¯´æ˜æ–‡æ¡£
```

## ğŸ”§ æŠ€æœ¯è¯´æ˜

- **æ•°æ®æ¥æº**: [Bestdori API](https://bestdori.com/api/)
- **æ¸²æŸ“å¼•æ“**: html2image (åŸºäº Chrome/Edge)
- **æ¨¡æ¿å¼•æ“**: Jinja2
- **å›¾ç‰‡å¤„ç†**: Pillow
- **å¼‚æ­¥æ”¯æŒ**: aiohttp

## ğŸ® æ”¯æŒçš„è§’è‰² (46äºº)

| ä¹é˜Ÿ | æˆå‘˜ |
|------|------|
| Poppin'Party | é¦™æ¾„ã€æœ‰å’²ã€é‡Œç¾ã€æ²™ç»«ã€æƒ æƒ  |
| Afterglow | å…°ã€æ‘©å¡ã€ç»¯ç›ä¸½ã€å·´ã€ï¿½çš„é¸« |
| Hello, Happy World! | å¿ƒã€è–°ã€è‚²ç¾ã€èŠ±éŸ³ã€ç¾å’² |
| Pastelï¼ŠPalettes | å½©ã€æ—¥èœã€åƒåœ£ã€éº»å¼¥ã€ä¼ŠèŠ™ |
| Roselia | å‹å¸Œé‚£ã€çº±å¤œã€è‰èã€äºšå­ã€ç‡å­ |
| Morfonica | çœŸç™½ã€é€å­ã€ä¸ƒæ·±ã€ç­‘ç´«ã€ç‘ å”¯ |
| RAISE A SUILEN | Layerã€å…­èŠ±ã€Maskingã€Pareoã€CHUÂ² |
| MyGO!!!!! | ç¯ã€çˆ±éŸ³ã€ä¹å¥ˆã€ç´ ä¸–ã€ç«‹å¸Œ |
| Ave Mujica | åˆåã€ç¦ã€æµ·é“ƒã€å–µæ¢¦ã€ç¥¥å­ |
| å…¶ä»– | çº¯ç”°çœŸå¥ˆ |

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.2.0 (2026-01-26)
- ğŸ¨ å…¨æ–°æ´»åŠ¨ç»¼åˆä¸€è§ˆç•Œé¢ï¼ˆæ–°å¡é¢ã€æ‹›å‹Ÿã€æŠ¥é…¬æˆå‘˜ã€è¿½åŠ æ­Œæ›²ï¼‰
- ğŸ“‹ ä¸‰çº§èœå•äº¤äº’ç³»ç»Ÿï¼Œæ”¯æŒæ•°å­—å¿«æ·é€‰æ‹©
- ğŸ’¾ æ™ºèƒ½ç¼“å­˜ç®¡ç†ç³»ç»Ÿï¼ˆLRUæ¸…ç†ã€è¿‡æœŸæ£€æµ‹ï¼‰
- ğŸ“¢ è®¢é˜…æ’­æŠ¥ç³»ç»Ÿï¼ˆæ”¯æŒç¾¤ç»„å’Œç”¨æˆ·è®¢é˜…ï¼‰
- ğŸ”§ ç¼“å­˜ç®¡ç†å‘½ä»¤ï¼ˆç»Ÿè®¡ã€æ¸…ç†ã€APIåˆ·æ–°ï¼‰
- ğŸ–¼ï¸ å¡é¢å¤–æ¡†ä¼˜åŒ–ï¼ˆripå¤§å›¾ä½¿ç”¨frame-Xç³»åˆ—ï¼‰
- âš™ï¸ ä¾èµ–è‡ªåŠ¨æ£€æŸ¥ä¸å®‰è£…

### v1.1.0
- ğŸ‚ ç”Ÿæ—¥ç³»ç»Ÿä¸å®šæ—¶æ’­æŠ¥
- ğŸ´ è§’è‰²å¡é¢æŸ¥è¯¢

### v1.0.0
- ğŸ“… åŸºç¡€æ´»åŠ¨æŸ¥è¯¢åŠŸèƒ½

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

- [Bestdori](https://bestdori.com) - æä¾›æ¸¸æˆæ•°æ® API
- [AstrBot](https://github.com/Soulter/AstrBot) - æœºå™¨äººæ¡†æ¶
